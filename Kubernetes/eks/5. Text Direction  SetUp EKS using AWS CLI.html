<p>This document will explain all steps to Create EKS cluster and Worker Nodes using AWS CLI. Also, execute the application on Kubernetes in AWS.</p><p><br></p><p><strong>Pre-requisites:</strong></p><pre class="prettyprint linenums">  AWSCLI
  Install kubectl
  Install aws-iam-authenticator</pre><p><br></p><p>Step 1:&nbsp; AWS CLI needed to interact with AWS cloud resources. A profile with administrative access should be configured.</p><pre class="prettyprint linenums">aws --version
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
aws --version</pre><p><br></p><p>Step 2: Install kubectl configuration</p><pre class="prettyprint linenums">curl -o kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.18.9/2020-11-02/bin/linux/amd64/kubectl
chmod +x ./kubectl
sudo mv ./kubectl /usr/local/bin
kubectl version --short --client</pre><p><br></p><p>Step 3: Install aws-iam-authenticator on the machine.</p><pre class="prettyprint linenums">curl -o aws-iam-authenticator https://amazon-eks.s3.us-west-2.amazonaws.com/1.18.9/2020-11-02/bin/linux/amd64/aws-iam-authenticator
chmod +x ./aws-iam-authenticator
sudo mv ./aws-iam-authenticator /usr/local/bin
aws-iam-authenticator help</pre><p><br></p><p>Step 4: Create Role (for accessing EKS cluster create a role with AmazonEKSClusterPolicy and AmazonEKSServicePolicy policies)</p><p><br></p><p>Step 5: Create VPC by using Cloudformation template</p><p><code>https://s3.us-west-2.amazonaws.com/amazon-eks/cloudformation/2020-10-29/amazon-eks-vpc-private-subnets.yaml</code></p><p><br></p><p>Step 6: Create an EKS Cluster using AWS CLI (Replace VPC, Subnets, Security Group IDs as we discussed in Video Lecture.)</p><pre class="prettyprint linenums">aws eks create-cluster \
  --name eks-cluster \
  --region ap-south-1 \
  --role-arn arn:aws:iam::164435161465:role/AWSEKS \
  --resources-vpc-config subnetIds=subnet-0e9262808d9590cd1,subnet-0334a7efa5f08d8ec,subnet-0a887939bf2e8e5b3,subnet-03bdcfb2e971600f9,securityGroupIds=sg-047618421cb9aebbe</pre><p><br></p><p>Status check for EKS cluster -</p><p><code>aws eks --region us-east-2 describe-cluster --name eks-cluster --query cluster.status</code></p><p><br></p><p>Step 7:&nbsp; Update Cluster in Kube Config for KubeCtl</p><pre class="prettyprint linenums">aws eks --region us-east-1 update-kubeconfig --name eks-cluster
kubectl get svc</pre><p>Identify the nodes attached with EKS Cluster.</p><p><code>kubectl get nodes</code></p><p><br></p><p>Step 8: Create nodes for the EKS cluster using the Cloudformation template</p><p><code>https://s3.us-west-2.amazonaws.com/amazon-eks/cloudformation/2020-10-29/amazon-eks-nodegroup.yaml</code></p><p><br></p><p>Step 9: Map Nodes to EKS Master Node</p><p><code>curl -o aws-auth-cm.yaml https://s3.us-west-2.amazonaws.com/amazon-eks/cloudformation/2020-10-29/aws-auth-cm.yaml</code></p><p><br></p><p>Update Node Role ARN in the file and apply that config using the below command.</p><p><code>kubectl apply -f aws-auth-cm.yaml</code></p><p><br></p><p>Step 10: Check nodes of the cluster</p><p><code>kubectl get nodes --watch</code></p><p><br></p><p>Step 11: Deploy Nginx image</p><p><code>kubectl create deployment --image=nginx nginx-app</code></p><p><code>kubectl get deployments</code></p><p><br></p><p>Step 12: Create Service in Kubernetes to connect with Deloyment</p><p><code>kubectl expose deployment nginx-app --port=80 --name=nginx-http --type LoadBalancer</code>	</p><p><code>kubectl get svc nginx-http</code></p><p>Now you would be able to access your deployment over the Load Balancer created by EKS Service.</p>